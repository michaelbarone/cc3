### Epic 3: Core URL & Group Management with Basic Iframe Display
**Goal:** Enable administrators to create, manage, and organize URLs (with required titles, optional server-hosted favicons including auto-discovery attempts) and URL Groups (`name` not globally unique). Enable all authenticated users to view groups/URLs assigned to them. Implement basic functionality to display a selected URL in an iframe (with opacity/underline/border indicators for URL items and refined display logic for broken favicons, empty states), using a default desktop top-menu and mobile drawer navigation, and multi-iframe handling with `visibility:hidden` for state preservation.

* **Story 3.1: Define Core Content & Access Prisma Schemas (URLs, Groups, UserGroupAccess, UrlInGroup)**
    * **As the** System/Developer,
    * **I want** robust Prisma schemas defined for `Url` entities (storing URL details like original URL, a **required** title, and paths to server-hosted favicons), `Group` entities (for organizing URLs, with properties like a unique name and description), a `UrlInGroup` relation (to manage URLs within groups, including their display order and group-specific properties), and a `UserGroupAccess` relation (to link specific users to groups they are permitted to access), with appropriate referential actions (`onDelete: SetNull`) for user deletion concerning creator fields.
    * **So that** the application has a clear, relational, and extensible database structure for managing all core content, its organization, user-specific access rights, and maintains integrity if creator/assigner users are deleted.
    * **Acceptance Criteria:**
        * `[ ]` The `prisma/schema.prisma` file is updated to include new model definitions for `Url`, `Group`, `UrlInGroup`, and `UserGroupAccess`.
        * `[ ]` The existing `User` model (from Story 1.2) is updated to include necessary relation fields.
        * `[ ]` A `Url` model is defined with at least: `id` (String, `@id @default(cuid())`), `originalUrl` (String, `@unique`), `title` (String) **(Required)**, `faviconUrl` (String, Optional `?` - Path to server-hosted, uploaded icon for this URL), `notes` (String, Optional `?`), `mobileSpecificUrl` (String, Optional `?`), `createdAt` (DateTime, `@default(now())`), `updatedAt` (DateTime, `@updatedAt`), `groups` (Relation field: `UrlInGroup[]`), `addedByUserId` (String, Optional `?`), `addedBy` (Relation field: `User? @relation("AddedUrls", fields: [addedByUserId], references: [id], onDelete: SetNull)`).
        * `[ ]` A `Group` model is defined with at least: `id` (String, `@id @default(cuid())`), `name` (String - **Not globally unique**), `description` (String, Optional `?`), `displayOrder` (Int, Optional `?`), `createdAt` (DateTime, `@default(now())`), `updatedAt` (DateTime, `@updatedAt`), `urls` (Relation field: `UrlInGroup[]`), `accessibleToUsers` (Relation field: `UserGroupAccess[]`), `createdByUserId` (String, Optional `?`), `createdBy` (Relation field: `User? @relation("CreatedGroups", fields: [createdByUserId], references: [id], onDelete: SetNull)`).
        * `[ ]` A `UrlInGroup` model is defined with: `id` (String, `@id @default(cuid())`), `urlId` (String), `url` (Relation: `Url @relation(fields: [urlId], references: [id], onDelete: Cascade)`), `groupId` (String), `group` (Relation: `Group @relation(fields: [groupId], references: [id], onDelete: Cascade)`), `displayOrderInGroup` (Int, default: 0), `groupSpecificTitle` (String, Optional `?`), `addedToGroupAt` (DateTime, `@default(now())`), `@@unique([urlId, groupId])`. (Field `groupSpecificFaviconUrl` was removed).
        * `[ ]` A `UserGroupAccess` model is defined with: `id` (String, `@id @default(cuid())`), `userId` (String), `user` (Relation: `User @relation(fields: [userId], references: [id], onDelete: Cascade)`), `groupId` (String), `group` (Relation: `Group @relation(fields: [groupId], references: [id], onDelete: Cascade)`), `assignedAt` (DateTime, `@default(now())`), `@@unique([userId, groupId])`.
        * `[ ]` The `User` model in `schema.prisma` is updated to include the inverse relations: `addedUrls: Url[] @relation("AddedUrls")`, `createdGroups: Group[] @relation("CreatedGroups")`, `groupAccesses: UserGroupAccess[]`.
        * `[ ]` A new Prisma migration (e.g., `add_content_access_url_favicon_schemas_final_v2`) is successfully generated from all schema updates.
        * `[ ]` This migration is successfully applied to the SQLite database, creating/altering the necessary tables and relations.
        * `[ ]` The migration files are present in `/prisma/migrations`.
        * `[ ]` Prisma Client is successfully (re)generated (`npx prisma generate`) to include types and methods for interacting with all new and updated models.

* **Story 3.2: Implement Admin API Endpoints for CRUD Operations on URL Groups**
    * **As an** Administrator (interacting via a future Admin UI),
    * **I want** to have secure backend API endpoints, specifically at the path `/api/admin/urlGroups`, that allow me to Create new URL groups, Read (list) all existing groups (sorted by `displayOrder` then `name`), Update the properties of a specific group (like its name, description, or global display order), and Delete a group.
    * **So that** I can centrally manage the library of URL groups that will form the organizational backbone for the URLs presented to users.
    * **Acceptance Criteria:**
        * `[ ]` New API route handlers are created under the path `/api/admin/urlGroups` (e.g., `/app/api/admin/urlGroups/route.ts` for list/create, and `/app/api/admin/urlGroups/[groupId]/route.ts` for get/update/delete).
        * `[ ]` All endpoints under `/api/admin/urlGroups` are protected and strictly require the requester to be authenticated with an `ADMIN` role. Unauthorized (401) or forbidden (403) access attempts are rejected with appropriate HTTP error responses.
        * `[ ]` (`POST /api/admin/urlGroups` - Create Group): Accepts a JSON request body containing: `name` (String, required), `description` (String, optional), `displayOrder` (Integer, optional - defaults to a sensible value like 0 or end-of-list if not provided). Server-side validation ensures `name` is provided and is not empty. The `createdByUserId` field on the new `Group` is populated with the `id` of the authenticated admin making the request. Returns the newly created `Group` object (including its generated `id` and all fields) with an HTTP 201 Created status. Handles errors (e.g., validation failure) by returning appropriate error responses (e.g., 400 Bad Request). (Uniqueness for `name` is NOT enforced at DB level).
        * `[ ]` (`GET /api/admin/urlGroups` - List Groups): Fetches all `Group` records from the database using Prisma. Returns a JSON array of `Group` objects. Each object should include at least `id`, `name`, `description`, `displayOrder`, `createdAt`, `updatedAt`, and `createdByUserId`. The returned list is sorted primarily by `displayOrder` in ascending order (nulls last or first consistently), and secondarily by `name` in ascending order. Returns an empty array (`[]`) with an HTTP 200 OK status if no groups exist.
        * `[ ]` (`GET /api/admin/urlGroups/[groupId]` - Get Single Group Details): Accepts a `groupId` as a URL path parameter. Fetches the specific `Group` record from the database by its `id` using Prisma, including all relevant fields. If the group is found, returns the full `Group` object with an HTTP 200 OK status. If no group exists with the provided `groupId`, returns an HTTP 404 Not Found status.
        * `[ ]` (`PUT /api/admin/urlGroups/[groupId]` - Update Group): Accepts a `groupId` as a URL path parameter. Accepts a JSON request body containing optional fields to update: `name` (String), `description` (String), `displayOrder` (Integer). Server-side validation ensures if `name` is provided, it is not empty. Updates only the provided fields of the specified `Group` record in the database using Prisma. Returns the fully updated `Group` object with an HTTP 200 OK status. If no group exists with the provided `groupId`, returns an HTTP 404 Not Found status. Handles potential errors with appropriate error responses.
        * `[ ]` (`DELETE /api/admin/urlGroups/[groupId]` - Delete Group): Accepts a `groupId` as a URL path parameter. Deletes the specified `Group` record from the database using Prisma. Related entries in `UrlInGroup` and `UserGroupAccess` tables are automatically deleted due to the `onDelete: Cascade` rule defined in their Prisma schema relations (verified). Returns an HTTP 204 No Content status or an HTTP 200 OK status with a success message upon successful deletion. If no group exists with the provided `groupId`, returns an HTTP 404 Not Found status.
        * `[ ]` (Consistent Error Handling) All API endpoints under `/api/admin/urlGroups` implement consistent error handling, returning standard HTTP status codes and clear JSON error messages that can be consumed by the frontend.

* **Story 3.3: Implement Admin API Endpoints for CRUD Operations on Global URLs (with Enhanced Icon Auto-Fetch)**
    * **As an** Administrator (interacting via a future Admin UI),
    * **I want** to have secure backend API endpoints that allow me to Create new global URL entries (where the system attempts to auto-discover and fetch a link to the best available **application icon/favicon**, and a `title` is required), Read all existing global URLs (sorted by `title`), Update their properties, and Delete global URL entries.
    * **So that** I can centrally manage the master library of all URLs available within ControlCenter, with an attempt to automatically populate representative icons for convenience, while still allowing manual override by uploading a custom icon.
    * **Acceptance Criteria:**
        * `[ ]` (API Endpoint Structure & Security) API routes are created under `/api/admin/urls` (e.g., `/app/api/admin/urls/route.ts` for list/create, and `/app/api/admin/urls/[urlId]/route.ts` for get/update/delete). All endpoints require the requester to be authenticated with an `ADMIN` role.
        * `[ ]` (`POST /api/admin/urls` - Create Global URL) Accepts a JSON request body containing: `originalUrl` (String, required), `title` (String, required), `faviconUrl` (String, optional - path to a *manually specified/uploaded* icon; if provided, auto-discovery is skipped), `notes` (String, optional), `mobileSpecificUrl` (String, optional).
        * `[ ]` Server-side validation for `POST /api/admin/urls` ensures: `originalUrl` (required, valid URL format, unique), `title` (required, not empty), `mobileSpecificUrl` (valid URL format if provided).
        * `[ ]` **Enhanced Icon Auto-Discovery Logic (for `POST /api/admin/urls`):** If `faviconUrl` is **not** provided in the request: The backend attempts (best-effort, short timeout e.g., 3-5 seconds) to discover a link to the best available representative icon for `originalUrl` (checks favicons, apple-touch-icons, manifest icons, Open Graph images, prioritizing higher-res). Discovered URL stored in new `Url.faviconUrl` (stores link, not re-hosted file). If `faviconUrl` **is** provided, or auto-discovery fails, the provided `faviconUrl` (or null) is used.
        * `[ ]` New `Url` record created in Prisma with all details, the determined `faviconUrl`, and `addedByUserId` set to admin's ID. Returns new `Url` object (HTTP 201 Created). Handles errors (validation, `originalUrl` uniqueness 409, URL inaccessibility for icon fetch) with appropriate HTTP responses.
        * `[ ]` (`GET /api/admin/urls` - List All Global URLs) Fetches all `Url` records. Returns JSON array of `Url` objects (all relevant fields). List sorted by `title` alphabetically (ascending). Returns empty array (200 OK) if no URLs.
        * `[ ]` (`GET /api/admin/urls/[urlId]` - Get Single Global URL Details) Accepts `urlId`. Fetches specific `Url`. Returns `Url` object (200 OK) or 404 if not found.
        * `[ ]` (`PUT /api/admin/urls/[urlId]` - Update Global URL) Accepts `urlId`. Accepts JSON body with optional fields: `originalUrl`, `title`, `faviconUrl` (path to manually uploaded icon), `notes`, `mobileSpecificUrl`.
        * `[ ]` Server-side validation for `PUT /api/admin/urls/[urlId]`: If `originalUrl` changed: non-empty, valid URL, unique. If `title` provided: not empty. If `mobileSpecificUrl` provided (and not empty string): valid URL.
        * `[ ]` **Enhanced Icon Auto-Discovery on `originalUrl` Change (for `PUT /api/admin/urls/[urlId]`):** If `originalUrl` is provided and different from current, AND no explicit `faviconUrl` in update payload: backend attempts auto-discovery for new `originalUrl`. `Url.faviconUrl` updated if new one found. Explicit `faviconUrl` in payload takes precedence.
        * `[ ]` Updates specified fields of `Url` record. Returns updated `Url` object (200 OK) or 404. Handles errors.
        * `[ ]` (`DELETE /api/admin/urls/[urlId]` - Delete Global URL) Accepts `urlId`. Deletes `Url` record. Related `UrlInGroup` entries cascade delete (verified). Returns HTTP 204 No Content or 200 OK, or 404.
        * `[ ]` (Consistent Error Handling) Standard HTTP status codes and clear JSON error messages for all endpoints.

* **Story 3.4: Implement Admin API Endpoints for Managing URLs within Specific Groups**
    * **As an** Administrator (interacting via a future Admin UI),
    * **I want** to have secure backend API endpoints that allow me to add an existing global URL to a specific URL Group, list all URLs currently within a group (ordered by their group-specific display order), update properties of a URL specific to its membership in that group (like its display order or a group-specific title), and remove a URL from a group.
    * **So that** I can precisely curate and organize the content and presentation of URLs within each distinct group.
    * **Acceptance Criteria:**
        * `[ ]` (API Endpoint Structure & Security) New API route handlers created: `POST /api/admin/urlGroups/[groupId]/urls`, `GET /api/admin/urlGroups/[groupId]/urls`, `PUT /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]`, `DELETE /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]`. All require `ADMIN` role.
        * `[ ]` (`POST /api/admin/urlGroups/[groupId]/urls` - Add URL to Group) Accepts `groupId` (path). Accepts JSON body: `urlId` (String, required - ID of existing global `Url`), `displayOrderInGroup` (Integer, optional - defaults to 0 or end of list), `groupSpecificTitle` (String, optional). Server-side validation: `groupId` exists, `urlId` exists, combination of `urlId` and `groupId` is unique in `UrlInGroup`. Creates new `UrlInGroup` record. Returns new `UrlInGroup` object (or augmented URL) (HTTP 201 Created). Handles errors.
        * `[ ]` (`GET /api/admin/urlGroups/[groupId]/urls` - List URLs within Group) Accepts `groupId` (path). Fetches `UrlInGroup` for `groupId`, includes related `Url` data. Response: JSON array of objects (global `Url` data + `UrlInGroup` overrides like `effectiveTitle`, `urlInGroupId`, `displayOrderInGroup`). Sorted by `UrlInGroup.displayOrderInGroup` (ASC). 404 if group not found. Empty array (200 OK) if group exists but no URLs.
        * `[ ]` (`PUT /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]` - Update URL-in-Group Association) Accepts `groupId`, `urlInGroupId` (ID of `UrlInGroup` record). JSON body: `displayOrderInGroup?` (Integer), `groupSpecificTitle?` (String). Server-side validation. Updates specified `UrlInGroup` record. Returns updated `UrlInGroup` object (or augmented URL) (HTTP 200 OK). 404 if record/group not found.
        * `[ ]` (`DELETE /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]` - Remove URL from Group) Accepts `groupId`, `urlInGroupId`. Deletes `UrlInG`roup record. Does not delete global `Url` or `Group`. Returns HTTP 204 No Content or 200 OK. 404 if record/group not found.
        * `[ ]` (Consistent Error Handling) Standard HTTP status codes and JSON error messages.

* **Story 3.5: Develop Admin UI for URL Group Management**
    * **As an** Administrator,
    * **I want** an admin UI to CRUD URL Groups (list sorted by `displayOrder` then `name`), with confirmations.
    * **So that** I can visually manage URL groups.
    * **Acceptance Criteria:**
        * `[ ]` (UI Page & Access) `/admin/url-groups` page, admin layout, `ADMIN` only.
        * `[ ]` (List Groups) Fetches from `GET /api/admin/urlGroups`. Loading/error states. MUI `Table`/`List` shows `name`, `description?`, `displayOrder`. Sorted by API default (`displayOrder` ASC, then `name` ASC). Message if no groups. Actions column with Edit/Delete buttons. Link/action to manage URLs within each group (leads to Story 3.6 UI).
        * `[ ]` (Create Group) Prominent green/success MUI `Button` "Create New Group" opens `Dialog` with form (`name` (req), `description?`, `displayOrder?`). Client validation. Confirmation dialog ("Are you sure... create group '[name]'?"). On confirm, `POST` API. List refreshes. Success/error `Snackbar`.
        * `[ ]` (Edit Group) "Edit" action -> `Dialog` pre-filled. Admin modifies. Client validation. Confirmation dialog ("Are you sure... save changes to group '[original/new name]'?"). On confirm, `PUT` API. List refreshes. Success/error.
        * `[ ]` (Delete Group) "Delete" action -> `Dialog` with stern warning about cascade ("...delete group '[group name]'? Removes URLs from group & user access..."). `DELETE` API. List refreshes. Success/error.
        * `[ ]` (UX) MUI components, loading indicators, feedback. Responsive (desktop/tablet focus).

* **Story 3.6: Develop Admin UI for Managing URLs *within* a Selected Group**
    * **As an** Administrator,
    * **I want** a UI where, after selecting a Group, I can add existing global URLs, remove them, reorder (`displayOrderInGroup`), and edit their `groupSpecificTitle`.
    * **So that** I can curate content within each group.
    * **Acceptance Criteria:**
        * `[ ]` (UI Context) Accessed after selecting group from Story 3.5 UI (e.g., `/admin/url-groups/[groupId]/urls`). Admin layout. `ADMIN` only. Clearly indicates group being managed.
        * `[ ]` (Display URLs in Group) `GET /api/admin/urlGroups/[groupId]/urls`. Loading/error. URLs in MUI `Table`/List, sorted `UrlInGroup.displayOrderInGroup`. Shows global `Url.faviconUrl` (or fallback, title if broken), `effectiveTitle`, `Url.originalUrl`, `displayOrderInGroup`. Message if empty. Actions column.
        * `[ ]` (Add Existing Global URL to Group) "Add URL to Group" green/success `Button`. `Dialog` with searchable list of global URLs (from `GET /api/admin/urls`). URLs already in current group de-emphasized/filtered. Admin selects URL, optionally sets initial `displayOrderInGroup`, `groupSpecificTitle`. Confirmation dialog. `POST /api/admin/urlGroups/[groupId]/urls`. List refreshes. Success/error `Snackbar`.
        * `[ ]` (Edit URL Properties *within* Group - `UrlInGroup`) "Edit Settings in Group" `IconButton` per URL. `Dialog` pre-filled: `displayOrderInGroup`, `groupSpecificTitle`. Read-only global `Url.title`/`originalUrl` for reference. Confirmation. `PUT /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]`. List refreshes.
        * `[ ]` (Reorder URLs in Group) Drag-and-drop or Up/Down `IconButtons` for `displayOrderInGroup`. Triggers API updates. UI reflects order.
        * `[ ]` (Remove URL from Group) "Remove from Group" `IconButton`. Confirmation ("...does not delete global URL."). `DELETE /api/admin/urlGroups/[groupId]/urls/[urlInGroupId]`. List refreshes.
        * `[ ]` (Navigation & UX) Easy nav back to Story 3.5. MUI, loading, feedback. Responsive.

* **Story 3.6.5: Develop Admin UI for Global URL Management**
    * **As an** Administrator, **I want** a dedicated admin page (`/admin/global-urls`) to list all global URLs, create new ones (with UI for icon auto-fetch feedback & manual `Url.faviconUrl` upload via drag-and-drop + button), edit global properties, and delete them, with confirmations. **So that** I have a central place to manage the master URL library.
    * **Acceptance Criteria:**
        * `[ ]` (UI Page & Access) `/admin/global-urls` page, admin layout, `ADMIN` only.
        * `[ ]` (List Global URLs) Fetches from `GET /api/admin/urls`. Loading/error. MUI `Table` shows `Url.faviconUrl` (or fallback, title if broken), `title`, `originalUrl`. Sorted `title` ASC. Client/server pagination. Message if no global URLs. Actions column (Edit, Delete).
        * `[ ]` (Create Global URL UI) Prominent green/success "Create New Global URL" `Button`. `Dialog` with form: `originalUrl` (req), `title` (req), `notes?`, `mobileSpecificUrl?`. Global Favicon Management Section: On `originalUrl` input, client triggers icon auto-discovery (Story 3.3). Preview auto-discovered icon. `Snackbar` if fetch fails. "Upload Custom Icon" (drag-and-drop zone + button; JPG/PNG/ICO, max 100KB, client validation, preview). Admin chooses for `Url.faviconUrl`.
        * `[ ]` Client validation. Confirmation. `POST /api/admin/urls`. Handles 409 duplicate `originalUrl` error from API in UI ("Error: URL exists as '[Existing Title]'..."). List refreshes. Success/error `Snackbar`.
        * `[ ]` (Edit Global URL UI) "Edit" `IconButton` per URL. `Dialog` pre-filled with global props. Admin modifies. Global Favicon Management UI (as in Create, including Re-check Auto-Discover, Remove Custom Icon) available. Confirmation. `PUT /api/admin/urls/[urlId]`. List refreshes.
        * `[ ]` (Delete Global URL UI) "Delete" `IconButton`. Confirmation ("...delete global URL '[title]'? Removed from all groups..."). `DELETE /api/admin/urls/[urlId]`. List refreshes.
        * `[ ]` (UX) MUI, loading, feedback. Responsive. Icon upload limits enforced.

* **Story 3.7: Implement API Endpoint for Authenticated Users to Fetch Their Accessible Groups and URLs**
    * **As an** Authenticated User, **I want** an API (`/api/dashboard/urlGroups`) for my accessible Groups & URLs (dates as ISO strings in JSON). **So that** the frontend can display personalized content.
    * **Acceptance Criteria:**
        * `[ ]` (API & Security) `GET /api/dashboard/urlGroups`. Authenticated (any role).
        * `[ ]` (Data Fetching) Identifies user. Queries `UserGroupAccess` for `groupId`s. For each, gets `Group` details. For each `Group`, gets `UrlInGroup` records (ordered by `displayOrderInGroup` ASC), including related `Url` data.
        * `[ ]` (API Response Structure) 200 OK JSON array of `Group` objects (sorted `Group.displayOrder` ASC then `Group.name` ASC). Each `Group`: `id, name, description?, displayOrder?`, `urls` array. Dates (e.g., `Group.createdAt`) are ISO strings. Each URL in `urls`: `urlId, urlInGroupId, effectiveTitle (UrlInGroup.groupSpecificTitle` or `Url.title`), `originalUrl, faviconUrl (global Url.faviconUrl), mobileSpecificUrl?, notes?, displayOrderInGroup`. Dates from `Url` are ISO strings.
        * `[ ]` (Empty States) Empty array `[]` if no accessible groups. Group's `urls` array empty if group has no URLs.
        * `[ ]` (Error Handling) Consistent (500 for server errors).
        * `[ ]` (Performance) Optimized DB query.

* **Story 3.8: Implement Global User Menu and Application Header**
    * **As an** Authenticated User, **I want** a consistent, responsive `AppBar` (conditional on desktop based on "Top Menu" pref, always on mobile with hamburger for drawer) with App Name/Logo, and a User Menu button (avatar/name) opening a dropdown (Dashboard, Settings, conditional Admin link, persisted Theme Toggle, Logout). **So that** I can easily navigate and manage my session/preferences.
    * **Acceptance Criteria:**
        * `[ ]` (AppBar Structure & Common Elements) MUI `AppBar`, persistent on auth pages. Left: App Logo/Name (Story 2.4 branding). Right: User Button (MUI `Button`/`IconButton` - avatar/name desktop, avatar only mobile; opens User Dropdown). Mobile Only (Far Left): Hamburger icon (MUI `IconButton`) toggles MUI `Drawer` state (drawer content by Story 3.9).
        * `[ ]` (Desktop "Top Menu Layout" Header Structure) If `menuPosition === TOP` (desktop): AppBar has 3 sections: `[Logo/Name (Left)] [Central Area for Top Navigation Content (Story 4.3)] [User Button (Right)]`. Mobile: central area hidden.
        * `[ ]` (User Dropdown Menu) Clicking User Button opens/closes MUI `Menu`. Items: "Dashboard" (`/dashboard`), "Settings" (`/settings/profile`), "Admin Area" (conditional on `ADMIN` role, to `/admin`) - all MUI `MenuItem`s + icons. Theme Control: "Toggle Theme" / "Light/Dark/System Mode" `MenuItem` + icons; toggles persisted theme (Story 4.1) via API, updates UI dynamically. Session Management: "Logout" `MenuItem` + icon; triggers `signOut({ callbackUrl: '/login' })`.
        * `[ ]` (Responsiveness & Interaction) AppBar & elements responsive. User Button adapts. Mobile Menu Toggle appears/disappears. Dropdown keyboard navigable, `Escape` closes. Focus managed.
        * `[ ]` (State & Context) Uses `useSession()` (user details, role, logout). Theme toggle uses Theme Context & persisted setting. Nav uses Next.js router.

* **Story 3.9: Implement User Dashboard UI with Multi-Iframe Handling, State Preservation, and Device-Specific Navigation**
    * **As an** Authenticated User, **I want** my dashboard to display assigned URLs/Groups with visual states (opacity 0.5 non-active/non-loaded, 1.0 non-active/loaded, 1.0 + active indicator: underline for Top Menu, right border for Side Menu/Mobile Drawer) via desktop top-menu or mobile drawer (accordion groups, active URL has blue right border). Selecting a URL makes its iframe visible (preserving state via `visibility:hidden` for others). First URL auto-loads. Selected group remembered during current session. Neutral UI (or console.log) for no groups. Handles broken favicons by showing title. No main page scroll.
    * **So that** I can access content with clear cues and state preservation for MVP.
    * **Acceptance Criteria:**
        * `[ ]` (Dashboard Page & Data) `/dashboard/page.tsx` in global layout (Story 3.8). Fetches from `GET /api/dashboard/urlGroups` (Story 3.7). Loading/error states. If no groups: neutral UI (e.g., "Dashboard is empty."), `console.log`.
        * `[ ]` (Desktop Group/URL Display - "Top Menu" Style - when `menuPosition === 'TOP'`) `AppBar` (Story 3.8) hosts content from Story 4.3 (hover-to-expand menu with group selection & horizontal URLs).
        * `[ ]` (Mobile Group/URL Display - Collapsible Left Drawer) On mobile: hamburger in `AppBar` (Story 3.8) toggles MUI `Drawer`. Inside Drawer: list of groups (sorted); each group MUI `Accordion` header. Clicking group expands in-place to show its URLs as sub-list. Selecting URL closes drawer.
        * `[ ]` (URL Item Visual States - for Desktop & Mobile lists) Active/selected URL: opacity `1.0` + blue underline (Top Menu) / blue right border (Side Menu & Mobile Drawer). Inactive but loaded URL: opacity `1.0`. Inactive and non-loaded URL: opacity `0.5`.
        * `[ ]` (Multi-Iframe Management & Display - Foundational for Epic 3, fully built in Story 4.2) One iframe per unique `originalUrl` selected, added to DOM if new. Active URL's iframe: `visibility: visible`. Others: `visibility: hidden; position:absolute; left:-9999px;`. State preserved. `src`/`data-src` pattern used for loading.
        * `[ ]` (Initial Iframe Load & Basic State Indicators) First URL of default group auto-loads into iframe. Iframe `src` set first time: loading indicator (MUI `CircularProgress`/text). On success, indicator removed, URL item "loaded" state (opacity 1.0). On failure, error message in iframe area, URL item "unloaded" state (opacity 0.5).
        * `[ ]` (Selected Group State Persistence - Current Session) Selected group maintained during current active session (e.g., React Context/state). Resets on full reload/new login for Epic 3.
        * `[ ]` (Broken Favicon Handling) If `Url.faviconUrl` image fails to load, broken icon hidden, `effectiveTitle` is primary identifier.
        * `[ ]` (UX & Layout) Intuitive flow. Clear layout separation. No main page scrollbars, 100% viewport height.

