---
description: Rule for automatically committing changes made by CursorAI using conventional commits format.
globs: "**/*"
alwaysApply: true
---
# Git Conventional Commits

Rule for automatically committing changes made by CursorAI using conventional commits format.

<rule>
name: conventional_commits
description: Automatically commit changes made by CursorAI using conventional commits format with support for breaking changes, multiple scopes, and detailed descriptions

filters:
  - type: event
    pattern: "build_success"
  - type: file_change
    pattern: "*"

actions:
  - type: suggest
    message: |
      Changes should be committed using conventional commits format:

      Format: <type>(<scope>): <description>
             [BREAKING CHANGE: <breaking change description>]
             [<body>]
             [<footer>]

      Types:
      - feat: A new feature
      - fix: A bug fix
      - docs: Documentation only changes
      - style: Changes that do not affect the meaning of the code
      - refactor: A code change that neither fixes a bug nor adds a feature
      - perf: A code change that improves performance
      - test: Adding missing tests or correcting existing tests
      - chore: Changes to the build process or auxiliary tools

      Scope:
      - Can be multiple, comma-separated
      - Derived from file path and content
      - Optional if no specific scope applies

      Breaking Changes:
      - Add "BREAKING CHANGE:" in the description
      - Will be automatically detected and formatted

      Body and Footer:
      - Body: Detailed description of the change
      - Footer: References to issues (e.g., "Closes #123")

      ## Multi-line Commit Examples

      ### PowerShell Examples

      1. Using Here-String (Recommended):
      ```powershell
      # Best for complex multi-line messages with formatting
      $commitMessage = @"
      feat(auth): implement OAuth2 authentication

      - Add OAuth2 provider integration
      - Implement token refresh logic
      - Add user session management
      - Update authentication middleware

      BREAKING CHANGE: New authentication flow requires updated client configuration
      Closes #123
      "@
      git commit -m $commitMessage
      ```

      2. Using Multiple -m Parameters:
      ```powershell
      # Good for bullet-point style messages
      git commit -m "feat(ui): add new dashboard components" `
                -m "" `
                -m "- Implement metric cards" `
                -m "- Add chart components" `
                -m "- Create responsive layout" `
                -m "" `
                -m "Closes #456"
      ```

      3. Using String Array Join:
      ```powershell
      # Best for programmatic commits
      $message = @(
          "feat(api): add new endpoints"
          ""
          "- Add user management endpoints"
          "- Implement rate limiting"
          "- Add request validation"
          ""
          "Closes #789"
      ) -join "`n"
      git commit -m $message
      ```

      4. Using Environment Variable with Editor:
      ```powershell
      # Best for very complex commits
      $env:GIT_EDITOR = "code --wait"
      git commit
      ```

      ### Bash Examples

      1. Using Heredoc (Recommended):
      ```bash
      # Best for complex multi-line messages with formatting
      git commit -m "$(cat << 'EOF'
      feat(auth): implement OAuth2 authentication

      - Add OAuth2 provider integration
      - Implement token refresh logic
      - Add user session management
      - Update authentication middleware

      BREAKING CHANGE: New authentication flow requires updated client configuration
      Closes #123
      EOF
      )"
      ```

      2. Using Multiple -m Parameters:
      ```bash
      # Good for bullet-point style messages
      git commit -m "feat(ui): add new dashboard components" \
                -m "" \
                -m "- Implement metric cards" \
                -m "- Add chart components" \
                -m "- Create responsive layout" \
                -m "" \
                -m "Closes #456"
      ```

      3. Using Variable with Newlines:
      ```bash
      # Best for programmatic commits
      message="feat(api): add new endpoints

      - Add user management endpoints
      - Implement rate limiting
      - Add request validation

      Closes #789"
      git commit -m "$message"
      ```

      4. Using Environment Variable with Editor:
      ```bash
      # Best for very complex commits
      export GIT_EDITOR="code --wait"
      git commit
      ```

      ## Best Practices for Multi-line Commits

      1. Here-String/Heredoc Method:
         - Best for complex multi-line messages
         - Preserves formatting exactly
         - Easiest to read and maintain
         - Use when commit has detailed body

      2. Multiple `-m` Parameters:
         - Good for bullet-point style messages
         - Each `-m` creates a new paragraph
         - Use backtick (PowerShell) or backslash (Bash) for line continuation
         - Always include empty lines between sections

      3. String/Variable Method:
         - Good for programmatic commits
         - Allows dynamic content
         - Use array join in PowerShell
         - Use embedded newlines in Bash

      4. Editor Method:
         - Best for very complex commits
         - Allows template usage
         - Full editor capabilities
         - Good for collaborative review

      ## Common Pitfalls to Avoid

      1. PowerShell - Don't use newlines directly:
      ```powershell
      # BAD: Newlines won't work as expected
      git commit -m "feat(scope): title
      body line 1
      body line 2"
      ```

      2. PowerShell - Don't use && for command chaining:
      ```powershell
      # BAD: Using && will fail in PowerShell
      git add . && git commit -m "feat(scope): new feature"

      # BAD: Attempting to combine commands with &&
      git add . && git commit -m "feat(scope): title" && git push

      # BAD: Mixed command chaining
      git add . && git commit -m "feat(scope): changes
      with newlines" && git push
      ```

      3. PowerShell - Don't use incorrect line continuation:
      ```powershell
      # BAD: Incorrect line continuation
      git commit -m "feat(scope): title \
      body line 1 \
      body line 2"

      # BAD: Missing backtick for line continuation
      git commit -m "feat(ui): add components"
                -m "- First change"
                -m "- Second change"
      ```

      4. PowerShell - Instead use these correct approaches:
      ```powershell
      # GOOD: Using here-string
      $msg = @"
      feat(scope): title

      body line 1
      body line 2
      "@
      git commit -m $msg

      # GOOD: Using semicolon or separate lines
      git add .; git commit -m "feat(scope): new feature"

      # GOOD: Using proper line continuation
      git commit -m "feat(ui): add components" `
                -m "- First change" `
                -m "- Second change"

      # GOOD: Using command sequence
      git add .
      git commit -m "feat(scope): new feature"
      git push
      ```

      5. PowerShell - Don't use string concatenation:
      ```powershell
      # BAD: String concatenation for multi-line
      $msg = "feat(scope): title" + "`n" +
             "body line 1" + "`n" +
             "body line 2"
      git commit -m $msg

      # BAD: Mixed string types
      $msg = 'feat(scope): title' + "`n" +
             'body line 1'
      git commit -m $msg
      ```

      6. PowerShell - Instead use proper string formatting:
      ```powershell
      # GOOD: Using string array join
      $msg = @(
          "feat(scope): title"
          ""
          "body line 1"
          "body line 2"
      ) -join "`n"
      git commit -m $msg

      # GOOD: Using format operator
      $type = "feat"
      $scope = "ui"
      $msg = "{0}({1}): add new components" -f $type, $scope
      git commit -m $msg
      ```

      3. Bash - Don't use:
      ```bash
      # BAD: Escaping newlines incorrectly
      git commit -m "feat(scope): title \n\
      body line 1 \n\
      body line 2"
      ```

      4. Bash - Instead use:
      ```bash
      # GOOD: Using heredoc
      git commit -m "$(cat << 'EOF'
      feat(scope): title

      body line 1
      body line 2
      EOF
      )"
      ```

examples:
  - input: |
      # After adding a new feature
      CHANGE_DESCRIPTION="add user authentication function"
      FILE="src/auth/login.ts"
    output: "feat(src-auth): add user authentication function"

  - input: |
      # After fixing a bug with breaking change
      CHANGE_DESCRIPTION="fix incorrect date parsing"
      FILE="lib/utils/date.js"
      # BREAKING CHANGE: Date format changed from ISO to Unix timestamp
    output: "fix(lib-utils,breaking): fix incorrect date parsing\n\nBREAKING CHANGE: Date format changed from ISO to Unix timestamp"

  - input: |
      # After adding feature with issue reference
      CHANGE_DESCRIPTION="add dark mode support"
      FILE="src/theme/dark-mode.ts"
      # Closes #123
    output: "feat(src-theme): add dark mode support\n\nCloses #123"

metadata:
  priority: high
  version: 1.1.0
</rule>
